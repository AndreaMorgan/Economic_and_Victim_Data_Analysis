#### Import Geopandas and Matplotlib
import geopandas as gpd
import matplotlib.pyplot as plt

#### Import shapefile for US States
# Set the filepath and load in a shapefile
fp = "Resources/tl_2018_us_state/tl_2018_us_state.shp"
map_df = gpd.read_file(fp)
map_df.head()

# Plot sample map to check it
map_df.plot()

#### Create dataframe
groupedconsolidated = relDF2017consolidated.groupby(["State"]).sum()
groupedconsolidated = groupedconsolidated.drop(axis=1, columns=["Year"])
groupedconsolidated = groupedconsolidated.reset_index()
groupedconsolidated = groupedconsolidated.rename(columns = {"State": "STUSPS"})
groupedconsolidated.head()

#### Merge shapefile and murder dataframe
merged = pd.merge(map_df, groupedconsolidated, on="STUSPS")
merged.head()

#### Set up chart
#Variable to be mapped
mapped_variable = "Immediate Family"

#Set the range for the choropleth
vmin, vmax = 0, 650

#Create figure and axes for Matplotlib
fig, ax = plt.subplots(1, figsize=(20, 10))

#### Create map
immediate_map = merged.plot(column=mapped_variable, cmap="GnBu", linewidth=0.8, edgecolor="0.8")

#### Set additional items for chart (turn off axis, set title, add colorbar legend)
# remove the axis
ax.axis("off")

#Set title
ax.set_title("Murders Committed by Immediate Family")

# Create colorbar as a legend
sm = plt.cm.ScalarMappable(cmap="GnBu", norm=plt.Normalize(vmin=vmin, vmax=vmax))
# empty array for the data range
sm._A = []
# add the colorbar to the figure
cbar = fig.colorbar(sm)

plt.show()
####WHY DOESN'T PLT.SHOW() SHOW IT WITH THESE ADDITIONS???